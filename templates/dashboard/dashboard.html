{% extends 'base.html'%}
{% load filters %}
{% load static %}
{% block content %}

<div class="page-body">
    <!-- Container-fluid starts-->
    <div class="container-fluid dashboard-default-sec">
      <div class="row">
        <div class="col-xl-5 box-col-12 des-xl-100"> 
          <div class="row">
            <div class="col-xl-12 col-md-6 box-col-6 des-xl-50">
              <div class="card profile-greeting">
                <div class="card-header">
                  <div class="header-top">
                    <div class="setting-list bg-primary position-unset">
                      <ul class="list-unstyled setting-option">
                        <li>
                          <div class="setting-white"><i style='font-size:28px' class="bi bi-emoji-smile"></i></div>
                        </li>
                        <li><i class="view-html fa fa-code font-white"></i></li>
                        <li><i class="icofont icofont-maximize full-card font-white"></i></li>
                        <li><i class="icofont icofont-minus minimize-card font-white"></i></li>
                        <li><i class="icofont icofont-refresh reload-card font-white"></i></li>
                        <li><i class="icofont icofont-error close-card font-white"> </i></li>
                      </ul>
                    </div>
                  </div>
                </div>
                <div class="card profile-greeting">
                  <!-- Existing content remains the same -->
                  {% if request.user.is_authenticated %}
                  <h3 class="font-light">Karibu Tena, {{request.user.username}}!!</h3>
                  {% endif %}
                  <p>Welcome to Jubilee Insurance Dashboard! We're committed to protecting what matters most to you with comprehensive insurance solutions tailored for Kenya.</p>
                </div>
                <div class="confetti">
                  <div class="confetti-piece"></div>
                  <div class="confetti-piece"></div>
                  <div class="confetti-piece"></div>
                  <div class="confetti-piece"></div>
                  <div class="confetti-piece"></div>
                  <div class="confetti-piece"></div>
                  <div class="confetti-piece"></div>
                  <div class="confetti-piece"></div>
                  <div class="confetti-piece"></div>
                  <div class="confetti-piece"></div>
                  <div class="confetti-piece"></div>
                  <div class="confetti-piece"></div>
                  <div class="confetti-piece"></div>
                  <div class="code-box-copy">
                    <button class="code-box-copy__btn btn-clipboard" data-clipboard-target="#profile-greeting" title="Copy"><i class="icofont icofont-copy-alt"></i></button>
                    <pre><code class="language-html" id="profile-greeting">                                     &lt;div class="card profile-greeting"&gt; 
                    &lt;div class="card-header"&gt;
                    &lt;div class="header-top"&gt;
                    &lt;div class="setting-list bg-primary"&gt;
                    &lt;ul class="list-unstyled setting-option"&gt;
                        &lt;li&gt;&lt;div class="setting-white"&gt;&lt;i class="icon-settings"&gt;&lt;/i&gt;&lt;/div&gt;&lt;/li&gt;
                        &lt;li&gt;&lt;i class="view-html fa fa-code font-white"&gt;&lt;/i&gt;&lt;/li&gt;
                        &lt;li&gt;&lt;i class="icofont icofont-maximize full-card font-white"&gt;&lt;/i&gt;&lt;/li&gt;
                        &lt;li&gt;&lt;i class="icofont icofont-minus minimize-card font-white"&gt;&lt;/i&gt;&lt;/li&gt;
                        &lt;li&gt;&lt;i class="icofont icofont-refresh reload-card font-white"&gt;&lt;/i&gt;&lt;/li&gt;
                        &lt;li&gt;&lt;i class="icofont icofont-error close-card font-white"&gt; &lt;/i&gt;&lt;/li&gt;
                    &lt;/ul&gt;
                    &lt;/div&gt;
                    &lt;/div&gt;
                    &lt;/div&gt;
                    &lt;div class="card-body text-center"&gt;
                    &lt;h3 class="font-light"&gt;Karibu Tena, John!!&lt;/h3&gt;
                    &lt;p&gt;Welcome to Jubilee Insurance Dashboard! We're committed to protecting what matters most to you.&lt;/p&gt;
                    &lt;button class="btn btn-light"&gt;Update Profile&lt;/button&gt;
                    &lt;/div&gt;
                    &lt;/div&gt;</code>
                    </pre>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-xl-6 col-md-3 col-sm-6 box-col-3 des-xl-25 rate-sec">
              <div class="card income-card card-primary">                                 
                <div class="card-body text-center">                                  
                  <div class="round-box">
                    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewbox="0 0 448.057 448.057" style="enable-background:new 0 0 448.057 448.057;" xml:space="preserve">
                      <g>
                        <g>
                          <path d="M404.562,7.468c-0.021-0.017-0.041-0.034-0.062-0.051c-13.577-11.314-33.755-9.479-45.069,4.099                                            c-0.017,0.02-0.034,0.041-0.051,0.062l-135.36,162.56L88.66,11.577C77.35-2.031,57.149-3.894,43.54,7.417                                            c-13.608,11.311-15.471,31.512-4.16,45.12l129.6,155.52h-40.96c-17.673,0-32,14.327-32,32s14.327,32,32,32h64v144                                            c0,17.673,14.327,32,32,32c17.673,0,32-14.327,32-32v-180.48l152.64-183.04C419.974,38.96,418.139,18.782,404.562,7.468z"></path>
                        </g>
                      </g>
                      <g>
                        <g>
                          <path d="M320.02,208.057h-16c-17.673,0-32,14.327-32,32s14.327,32,32,32h16c17.673,0,32-14.327,32-32                                            S337.694,208.057,320.02,208.057z"></path>
                        </g>
                      </g>
                    </svg>
                  </div>
                  <h5>{{ monthly_premiums|floatformat:2 }} Ksh</h5>
                  <p>Monthly Premiums</p>
                  <a class="btn-arrow arrow-primary" href="javascript:void(0)"><i class="toprightarrow-primary fa fa-arrow-up me-2"></i>
                    {% if new_policies_month > 0 %}
                      {{ new_policies_month }} new policies
                    {% else %}
                      No new policies
                    {% endif %}
                  </a>
                  <div class="parrten">
                    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewbox="0 0 448.057 448.057" style="enable-background:new 0 0 448.057 448.057;" xml:space="preserve">
                      <g>
                        <g>
                          <path d="M404.562,7.468c-0.021-0.017-0.041-0.034-0.062-0.051c-13.577-11.314-33.755-9.479-45.069,4.099                                            c-0.017,0.02-0.034,0.041-0.051,0.062l-135.36,162.56L88.66,11.577C77.35-2.031,57.149-3.894,43.54,7.417                                            c-13.608,11.311-15.471,31.512-4.16,45.12l129.6,155.52h-40.96c-17.673,0-32,14.327-32,32s14.327,32,32,32h64v144                                            c0,17.673,14.327,32,32,32c17.673,0,32-14.327,32-32v-180.48l152.64-183.04C419.974,38.96,418.139,18.782,404.562,7.468z"></path>
                        </g>
                      </g>
                      <g>
                        <g>
                          <path d="M320.02,208.057h-16c-17.673,0-32,14.327-32,32s14.327,32,32,32h16c17.673,0,32-14.327,32-32                                            S337.694,208.057,320.02,208.057z">                                  </path>
                        </g>
                      </g>
                    </svg>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-xl-6 col-md-3 col-sm-6 box-col-3 des-xl-25 rate-sec">
              <div class="card income-card card-secondary">                                    
                <div class="card-body text-center">
                  <div class="round-box">
                    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewbox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve">
                      <g>
                        <g>
                          <path d="M256,0C114.615,0,0,114.615,0,256s114.615,256,256,256s256-114.615,256-256S397.385,0,256,0z M96,100.16                                            c50.315,35.939,80.124,94.008,80,155.84c0.151,61.839-29.664,119.919-80,155.84C11.45,325.148,11.45,186.851,96,100.16z M256,480                                            c-49.143,0.007-96.907-16.252-135.84-46.24C175.636,391.51,208.14,325.732,208,256c0.077-69.709-32.489-135.434-88-177.6                                            c80.1-61.905,191.9-61.905,272,0c-98.174,75.276-116.737,215.885-41.461,314.059c11.944,15.577,25.884,29.517,41.461,41.461                                            C353.003,463.884,305.179,480.088,256,480z M416,412v-0.16c-86.068-61.18-106.244-180.548-45.064-266.616                                            c12.395-17.437,27.627-32.669,45.064-45.064C500.654,186.871,500.654,325.289,416,412z"></path>
                        </g>
                      </g>
                    </svg>
                  </div>
                  <h5>{{ claims_paid|floatformat:2 }} Ksh</h5>
                  <p>Claims Paid</p><a class="btn-arrow arrow-secondary" href="javascript:void(0)"><i class="toprightarrow-secondary fa fa-arrow-up me-2"></i>{{ claims_this_month }} this month </a>
                  <div class="parrten">
                    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewbox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve">
                      <g>
                        <g>
                          <path d="M256,0C114.615,0,0,114.615,0,256s114.615,256,256,256s256-114.615,256-256S397.385,0,256,0z M96,100.16                                            c50.315,35.939,80.124,94.008,80,155.84c0.151,61.839-29.664,119.919-80,155.84C11.45,325.148,11.45,186.851,96,100.16z M256,480                                            c-49.143,0.007-96.907-16.252-135.84-46.24C175.636,391.51,208.14,325.732,208,256c0.077-69.709-32.489-135.434-88-177.6                                            c80.1-61.905,191.9-61.905,272,0c-98.174,75.276-116.737,215.885-41.461,314.059c11.944,15.577,25.884,29.517,41.461,41.461                                            C353.003,463.884,305.179,480.088,256,480z M416,412v-0.16c-86.068-61.18-106.244-180.548-45.064-266.616                                            c12.395-17.437,27.627-32.669,45.064-45.064C500.654,186.871,500.654,325.289,416,412z"></path>
                        </g>
                      </g>
                    </svg>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-xl-7 box-col-12 des-xl-100 dashboard-sec">
          <div class="card income-card">
            <div class="card-header">
              <div class="header-top d-sm-flex align-items-center">
                <h5>Policy Growth Overview</h5>
                <div class="center-content">
                  <p class="d-sm-flex align-items-center">
                    <span class="font-primary m-r-10 f-w-700">{{ active_policies }} active</span>
                    <i class="toprightarrow-primary fa fa-arrow-up m-r-10"></i>
                    {{ new_policies_month }} new this month
                  </p>
                </div>
              </div>
            </div>
            <div class="card-body p-0">
              <div id="chart-timeline-dashbord"></div>
            </div>
          </div>
        </div>
        <div class="col-xl-8 box-col-12 des-xl-100">
          <div class="row">
            <div class="col-xl-6 col-50 box-col-6 des-xl-50">
              <div class="card">
              <div class="card-header">
                <div class="header-top d-sm-flex align-items-center">
                  <h5>Customer Growth</h5>
                  <div class="center-content">
                    <p class="d-flex align-items-center">
                      <i class="toprightarrow-primary fa fa-arrow-up me-2"></i>
                      {{ new_customers_month }} new this month
                    </p>
                  </div>
                </div>
              </div>
              <div class="card-body p-0">
                <div id="chart-dashbord"></div>
              </div>
            </div>
            </div>
            <div class="col-xl-6 col-50 box-col-6 des-xl-50">

              <div class="card latest-update-sec">
                <div class="card-header">
                  <div class="header-top d-sm-flex align-items-center">
                    <h5>Latest Claims</h5>
                  </div>
                </div>
                <div class="card-body">
                  <div class="table-responsive">
                    <table class="table table-bordernone">
                      <tbody>
                        {% for claim in latest_claims %}
                        <tr>
                          <td>
                            <div class="media">
                              <svg><!-- Appropriate icon based on claim type --></svg>
                              <div class="media-body">
                                <span>{{ claim.get_claim_type_display }} Claim</span>
                                <p>Policy: {{ claim.policy.policy_number }}</p>
                              </div>
                            </div>
                          </td>
                          <td>
                            <span class="badge badge-{{ claim.status|claim_status_color }}">
                              {{ claim.get_status_display }}
                            </span>
                          </td>
                          <td>
                            <a href="#" target="_blank">View</a>
                          </td>
                        </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
              
            </div>
            <div class="col-xl-12 recent-order-sec">
              <div class="card">
              <div class="card-body">
                <div class="table-responsive">
                  <h5>Recent Payments</h5>
                  <table class="table table-bordernone">                                         
                    <thead>
                      <tr>                                        
                        <th>Customer</th>
                        <th>Date</th>
                        <th>Amount</th>
                        <th>Type</th>
                        <th>Status</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for payment in latest_payments %}
                      <tr>
                        <td>
                          <div class="media">
                            <img class="img-fluid rounded-circle" style="width: 25px; height:25px" src="{% static 'assets/images/profile.png'%}" alt="">
                            <div class="media-body">
                              <span>{{ payment.customer.first_name}} {{ payment.customer.last_name }}</span>
                            </div>
                          </div>
                        </td>
                        <td>{{ payment.payment_date|date:"M j Y" }}</td>
                        <td>{{ payment.amount|floatformat:2 }} Ksh</td>
                        <td>{{ payment.get_payment_type_display }}</td>
                        <td>
                          <span class="badge badge-{{ payment.status|payment_status_color }}">
                            {{ payment.get_status_display }}
                          </span>
                        </td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            </div>
          </div>
        </div>
        <div class="col-xl-4 box-col-12 des-xl-100">
          <div class="row">
            <div class="col-xl-12 box-col-6 des-xl-50">
              <div class="card">
                <div class="card-header">
                  <div class="header-top d-sm-flex align-items-center">
                    <h5>User Activations</h5>
                    <div class="center-content">
                      <p>Yearly User 24.65k</p>
                    </div>
                    <div class="setting-list">
                      <ul class="list-unstyled setting-option">
                        <li>
                          <div class="setting-primary"><i class="icon-settings"></i></div>
                        </li>
                        <li><i class="view-html fa fa-code font-primary"></i></li>
                        <li><i class="icofont icofont-maximize full-card font-primary"></i></li>
                        <li><i class="icofont icofont-minus minimize-card font-primary"></i></li>
                        <li><i class="icofont icofont-refresh reload-card font-primary"></i></li>
                        <li><i class="icofont icofont-error close-card font-primary"></i></li>
                      </ul>
                    </div>
                  </div>
                </div>
                <div class="card-body p-0">
                  <div id="user-activation-dash-2"></div>
                  <div class="code-box-copy">
                    <button class="code-box-copy__btn btn-clipboard" data-clipboard-target="#user-activations" title="Copy"><i class="icofont icofont-copy-alt"></i></button>
                    <pre><code class="language-html" id="user-activations">&lt;div class="card"&gt;
&lt;div class="card-header"&gt;
&lt;div class="header-top d-sm-flex align-items-center"&gt;
 &lt;h5&gt;User Activations&lt;/h5&gt;
 &lt;div class="center-content"&gt;
   &lt;p&gt;Yearly User 24.65k&lt;/p&gt;
 &lt;/div&gt;
 &lt;div class="setting-list"&gt;
     &lt;ul class="list-unstyled setting-option"&gt;
       &lt;li&gt;
         &lt;div class="setting-primary"&gt;
           &lt;i class="icon-settings"&gt;&lt;/i&gt;
         &lt;/div&gt;
       &lt;/li&gt;
       &lt;li&gt;
         &lt;i class="view-html fa fa-code font-primary"&gt;&lt;/i&gt;
       &lt;/li&gt;
       &lt;li&gt;
         &lt;i class="icofont icofont-maximize full-card font-primary"&gt;&lt;/i&gt;
       &lt;/li&gt;
       &lt;li&gt;
         &lt;i class="icofont icofont-minus minimize-card font-primary"&gt;&lt;/i&gt;
       &lt;/li&gt;
       &lt;li&gt;
         &lt;i class="icofont icofont-refresh reload-card font-primary"&gt;&lt;/i&gt;
       &lt;/li&gt;
       &lt;li&gt;
         &lt;i class="icofont icofont-error close-card font-primary"&gt;&lt;/i&gt;
       &lt;/li&gt;
     &lt;/ul&gt;
 &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="card-body p-0"&gt;
&lt;div id="user-activation-dash-2"&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</code></pre>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-xl-12 box-col-6 des-xl-50">
              <div class="card trasaction-sec">
                <div class="card-header">
                  <div class="header-top d-sm-flex align-items-center">
                    <h5>Transaction</h5>
                    <div class="center-content">
                      <p>5878 Suceessfull Transaction</p>
                    </div>
                    <div class="setting-list">
                      <ul class="list-unstyled setting-option">
                        <li>
                          <div class="setting-secondary"><i class="icon-settings">                                      </i></div>
                        </li>
                        <li><i class="view-html fa fa-code font-secondary"></i></li>
                        <li><i class="icofont icofont-maximize full-card font-secondary"></i></li>
                        <li><i class="icofont icofont-minus minimize-card font-secondary"></i></li>
                        <li><i class="icofont icofont-refresh reload-card font-secondary"></i></li>
                        <li><i class="icofont icofont-error close-card font-secondary"></i></li>
                      </ul>
                    </div>
                  </div>
                </div>
                <div class="transaction-totalbal">
                  <h2> $2,09,352k <span class="ms-3"> <a class="btn-arrow arrow-secondary" href="javascript:void(0)"><i class="toprightarrow-secondary fa fa-arrow-up me-2"></i>98.54%</a></span></h2>
                  <p>Total Balance</p>
                </div>
                <div class="card-body p-0">
                  <div id="chart-3dash"></div>
                  <div class="code-box-copy">
                    <button class="code-box-copy__btn btn-clipboard" data-clipboard-target="#transaction" title="Copy"><i class="icofont icofont-copy-alt"></i></button>
                    <pre><code class="language-html" id="transaction">&lt;div class="card trasaction-sec"&gt;
&lt;div class="card-header"&gt;
&lt;div class="header-top d-sm-flex align-items-center"&gt;
&lt;h5&gt;Transaction&lt;/h5&gt;
&lt;div class="center-content"&gt;
&lt;p&gt;5878 Suceessfull Transaction&lt;/p&gt;
&lt;/div&gt;
&lt;div class="setting-list"&gt;
&lt;ul class="list-unstyled setting-option"&gt;
 &lt;li&gt;
   &lt;div class="setting-secondary"&gt;
     &lt;i class="icon-settings"&gt; &lt;/i&gt;
   &lt;/div&gt;
 &lt;/li&gt;
 &lt;li&gt;
   &lt;i class="view-html fa fa-code font-secondary"&gt;&lt;/i&gt;
 &lt;/li&gt;
 &lt;li&gt;
   &lt;i class="icofont icofont-maximize full-card font-secondary"&gt;&lt;/i&gt;
 &lt;/li&gt;
 &lt;li&gt;
   &lt;i class="icofont icofont-minus minimize-card font-secondary"&gt;&lt;/i&gt;
 &lt;/li&gt;
 &lt;li&gt;
   &lt;i class="icofont icofont-refresh reload-card font-secondary"&gt;&lt;/i&gt;
 &lt;/li&gt;
 &lt;li&gt;
   &lt;i class="icofont icofont-error close-card font-secondary"&gt;&lt;/i&gt;
 &lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="transaction-totalbal"&gt;
&lt;h2&gt; $2,09,352k 
&lt;span class="ms-3"&gt;
&lt;a class="btn-arrow arrow-secondary" href="javascript:void(0)"&gt;
 &lt;i class="toprightarrow-secondary fa fa-arrow-up me-2"&gt;&lt;/i&gt;98.54%
&lt;/a&gt;
&lt;/span&gt;
&lt;/h2&gt;
&lt;p&gt;Total Balance&lt;/p&gt;
&lt;/div&gt;
&lt;div class="card-body p-0"&gt;
&lt;div id="chart-3dash"&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</code></pre>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Container-fluid Ends-->
  </div>

<script>
  // Policy Growth Chart
  var policyGrowthOptions = {
    chart: {
      type: 'area',
      height: 300,
      toolbar: { show: false }
    },
    colors: ['#7366ff'],
    dataLabels: { enabled: false },
    stroke: { curve: 'smooth', width: 2 },
    series: [{
      name: 'Policies',
      data: [
        {% for item in policy_growth %}
        ['{{ item.month|date:"M Y" }}', {{ item.count }}]{% if not forloop.last %},{% endif %}
        {% endfor %}
      ]
    }],
    xaxis: { type: 'datetime' },
    tooltip: { x: { format: 'MMM yyyy' } }
  };
  var policyGrowthChart = new ApexCharts(document.querySelector("#chart-timeline-dashbord"), policyGrowthOptions);
  policyGrowthChart.render();

  // Customer Growth Chart
  var customerGrowthOptions = {
    chart: {
      type: 'line',
      height: 300,
      toolbar: { show: false }
    },
    colors: ['#54ba4a'],
    dataLabels: { enabled: false },
    stroke: { curve: 'smooth', width: 2 },
    series: [{
      name: 'Customers',
      data: [
        {% for item in customer_growth %}
        ['{{ item.month|date:"M Y" }}', {{ item.count }}]{% if not forloop.last %},{% endif %}
        {% endfor %}
      ]
    }],
    xaxis: { type: 'datetime' },
    tooltip: { x: { format: 'MMM yyyy' } }
  };
  var customerGrowthChart = new ApexCharts(document.querySelector("#chart-dashbord"), customerGrowthOptions);
  customerGrowthChart.render();

  // Product Distribution Chart (for the user activation section)
  var productDistributionOptions = {
    chart: {
      type: 'donut',
      height: 300,
      toolbar: { show: false }
    },
    colors: ['#7366ff', '#54ba4a', '#f73164', '#a927f9', '#ffaa05'],
    series: [
      {% for product in product_distribution %}
      {{ product.policy_count }}{% if not forloop.last %},{% endif %}
      {% endfor %}
    ],
    labels: [
      {% for product in product_distribution %}
      "{{ product.name }}"{% if not forloop.last %},{% endif %}
      {% endfor %}
    ],
    legend: { position: 'bottom' }
  };
  var productDistributionChart = new ApexCharts(document.querySelector("#user-activation-dash-2"), productDistributionOptions);
  productDistributionChart.render();
</script>


  {% endblock %}